<!DOCTYPE html>
<html ng-app="blueit">
  <head>
    <meta charset="utf-8">
    <title>Blue It</title>

    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="vendor/materialize.min.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>

  <body ng-controller="TopicCtrl as TC" ng-cloak>
    <div class="navbar-fixed">
      <nav>
        <div class="nav-wrapper">
          <a href="#/" class="brand-logo">
            <span>
              <img class="logo-png" src="images/galvanize_logo.png" />
            </span>
            <span class="logo-text">blue-it</span>
          </a>
          <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
          <ul class="right hide-on-med-and-down">
            <li><a href="" ng-click="TC.toggleTopicForm()">New Topic<i class="material-icons right">add_circle_outline</i></a></li>
          </ul>
          <ul class="side-nav" id="mobile-demo">
            <li><a href="" ng-click="TC.toggleTopicForm()">New Topic<i class="material-icons right">add_circle_outline</i></a></li>
          </ul>
        </div>
      </nav>
    </div>

    <main>
      <section class="row" ng-show="TC.showTopicForm">
        <form ng-submit="TC.submitTopic(); topicForm.$setPristine();" name="topicForm" novalidate>
          <div class="input-field col s4 right">
            <input type="text" name="name" ng-class="{'valid': topicForm.name.$valid, 'invalid': topicForm.name.$invalid && topicForm.name.$dirty}" ng-model="TC.topicForm.name" ng-minlength=3 ng-maxlength=15 required>

            <label for="name" ng-class="{'green-text text-lighten-2': topicForm.name.$valid, 'red-text text-lighten-2': topicForm.name.$invalid && topicForm.name.$dirty}">Topic Name</label>

            <span ng-show="topicForm.name.$error.minlength && topicForm.name.$dirty">Topic must be at least 3 characters</span>
            <span ng-show="topicForm.name.$error.maxlength && topicForm.name.$dirty">Topic must be less than 15 characters</span>

            <input type="submit" class="btn orange darken-1 right" ng-class="{'disabled': topicForm.$invalid, 'waves-effect waves-light': topicForm.$valid}" value="Add Topic" ng-disabled="topicForm.$invalid">
          </div>
        </form>
      </section>

      <section class="row title">
        <div class="col s12">
          <div class="center">
            <h3>Posts</h3>
            <hr>
          </div>
        </div>
      </section>

      <section class="container row">
        <div class="input-field col offset-s3 s6">
          <select ng-model="TC.selectedTopic">
            <option value="" selected>All</option>
            <option ng-repeat="topic in TC.topics" value="{{ topic.id }}">
              {{ topic.name }}
            </option>
          </select>
          <label for="topics">Topics</label>
        </div>
      </section>

      <section class="container row" ng-controller="PostCtrl as PC">
        <div class="col offset-s2 s8">
          <div class="card" ng-repeat="post in PC.posts | filter : {topic_id: TC.selectedTopic} | orderBy : '-rating'" ng-class="{'green lighten-5': post.rating > 0, 'red lighten-5': post.rating < 0}">
            <div class="card-content">
              <div class="row">
                <div class="col s1 center-align">
                  <i class="material-icons" ng-click="post.rating = post.rating + 1">thumb_up</i>
                  <h5 ng-class="{'green-text': post.rating > 0, 'red-text': post.rating < 0}">{{ post.rating }}</h5>
                  <i class="material-icons" ng-click="post.rating = post.rating - 1">thumb_down</i>
                </div>
                <div class="col s3">
                  <img class="responsive-img z-depth-1" ng-src="{{ post.image_url }}" alt="{{ post.title }}">
                </div>
                <div class="col s8">
                  <h5>{{ post.title }}</h5>
                  <h6>
                    {{ post.created_at | date : "EEE, M/d/yy 'at' h:mm a" }}
                  </h6>
                  <p>
                    {{ post.description }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col s2">
          <a class="modal-trigger btn-floating btn-large waves-effect waves-light orange darken-1" href="#modal" ng-click="ctrl.initSelect()"><i class="material-icons">add</i></a>
        </div>

        <div id="modal" class="modal">
          <div class="modal-content">
            <h4>New Post</h4>
            <form ng-submit="PC.submitPost(); postForm.$setPristine();" name="postForm" novalidate>
              <div class="input-field col s12">
                <select ng-model="PC.postForm.topicId" name="topicId" required>
                  <option value="" selected disabled>Select Topic</option>
                  <option ng-repeat="topic in TC.topics" value="{{ topic.id }}">{{ topic.name }}</option>
                </select>
                <label for="topicId">Topic</label>
              </div>

              <div class="input-field col s12">
                <input type="text" name="title" ng-class="{'valid': postForm.title.$valid, 'invalid': postForm.title.$invalid && postForm.title.$dirty}" ng-model="PC.postForm.title" ng-minlength=3 ng-maxlength=32 required>
                <label for="title" ng-class="{'green-text text-lighten-2': postForm.title.$valid, 'red-text text-lighten-2': postForm.title.$invalid && postForm.title.$dirty}">Title</label>

                <span ng-show="postForm.title.$error.minlength && postForm.title.$dirty">Title must be at least 3 characters</span>
                <span ng-show="postForm.title.$error.maxlength && postForm.title.$dirty">Title must be less than 32 characters</span>
              </div>

              <div class="input-field col s12">
                <input type="url" name="imageUrl" ng-class="{'valid': postForm.imageUrl.$valid, 'invalid': postForm.imageUrl.$invalid && postForm.imageUrl.$dirty}" ng-model="PC.postForm.imageUrl" required>
                <label for="imageUrl" ng-class="{'green-text text-lighten-2': postForm.imageUrl.$valid, 'red-text text-lighten-2': postForm.imageUrl.$invalid && postForm.imageUrl.$dirty}">Image Url</label>

                <span ng-show="postForm.imageUrl.$error.url && postForm.imageUrl.$dirty">Please enter a valid url</span>
              </div>

              <div class="input-field col s12">
                <textarea class="materialize-textarea" name="description" ng-class="{'valid': postForm.description.$valid, 'invalid': postForm.description.$invalid && postForm.description.$dirty}" ng-model="PC.postForm.description" ng-minlength=3 ng-maxlength=60 required></textarea>
                <label for="description" ng-class="{'green-text text-lighten-2': postForm.description.$valid, 'red-text text-lighten-2': postForm.description.$invalid && postForm.description.$dirty}">Description</label>

                <span ng-show="postForm.description.$error.minlength && postForm.description.$dirty">description must be at least 3 characters</span>
                <span ng-show="postForm.description.$error.maxlength && postForm.description.$dirty">description must be less than 60 characters</span>
              </div>

              <input type="submit" class="btn orange darken-1 right" ng-class="{'disabled': postForm.$invalid, 'waves-effect waves-light': postForm.$valid}" value="Create Post" ng-disabled="postForm.$invalid">
            </form>
          </div>
        </div>
      </section>
    </main>

    <footer class="page-footer">
      <div class="footer-copyright">
        <small>Â© 2016 Galvanize, Inc. All Rights Reserved</small>
      </div>
    </footer>

    <script src="vendor/jquery-3.1.0.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>
    <script src="vendor/materialize.min.js"></script>

    <script src="js/app.js"></script>
    <script src="js/controllers.js"></script>
  </body>
</html>
